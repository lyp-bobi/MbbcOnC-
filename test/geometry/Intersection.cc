#include <spatialindex/SpatialIndex.h>

using namespace SpatialIndex;
using namespace std;

/* 
 * Test the Geometry
 * Nowhere near complete, but it's something
 */
int main(int argc, char** argv) {
    //define points
    double c1[2] = {1.0, 0.0};
    double c2[2] = {3.0, 2.0};
    double c3[2] = {2.0, 0.0};
    double c4[2] = {2.0, 4.0};
    double c5[2] = {1.0, 1.0};
    double c6[2] = {2.5, 3.0};
    double c7[2] = {1.0, 2.0};
    double c8[2] = {0.0, -1.0};
    double c9[2] = {4.0, 3.0};
    Point p1 = Point(&c1[0], 2); 
    Point p2 = Point(&c2[0], 2); 
    Point p3 = Point(&c3[0], 2); 
    Point p4 = Point(&c4[0], 2); 
    Point p5 = Point(&c5[0], 2); 
    Point p6 = Point(&c6[0], 2); 
    Point p7 = Point(&c7[0], 2); 
    Point p8 = Point(&c8[0], 2); 
    Point p9 = Point(&c9[0], 2); 
    
    double c3a[2] = {2.0, 3.0};
    Point p3a = Point(&c3a[0], 2); 
    
    //Now Test LineSegment intersection
    LineSegment ls1 = LineSegment(p1, p2);
    LineSegment ls2 = LineSegment(p3, p4);
    LineSegment ls3 = LineSegment(p3a, p4);

    if (!ls1.intersectsShape(ls2)) {
        cerr << "Test failed:  intersectsShape returned false, but should be true." << endl;
        cerr << ls1 << ", " << ls2 << endl;
        return -1;
    }

    if (ls1.intersectsShape(ls3)) {
        cerr << "Test failed:  intersectsShape returned true, but should be false." << endl;
        cerr << ls1 << ", " << ls3 << endl;
        return -1;
    }

    //Now LineSegment Region intersection
    Region r1 = Region(p5, p6);
    Region r2 = Region(p7, p6);
    Region r3 = Region(p8, p9);
    
    if (!r1.intersectsShape(ls1) || !ls1.intersectsShape(r1)) {
        cerr << "Test failed:  intersectsShape returned false, but should be true." << endl;
        cerr << r1 << ", " << ls1 << endl;
        return -1;
    }

    if (r2.intersectsShape(ls1) || ls1.intersectsShape(r2)) {
        cerr << "Test failed:  intersectsShape returned true, but should be false." << endl;
        cerr << r2 << ", " << ls1 << endl;
        return -1;
    }

    // This is the contains test
    if (!r3.intersectsShape(ls1) || !ls1.intersectsShape(r3)) {
        cerr << "Test failed:  intersectsShape returned false, but should be true." << endl;
        cerr << r3 << ", " << ls1 << endl;
        return -1;
    }

    //line distace test
//    double v1[2]={0,1},v2[2]={1,0},v3[2]={0,1},v4[2]={0,0};
//    double pLow[3]={0,0,0},pHigh[3]={1,1,1};
//    cout<<Trajectory::line2lineIED(TimePoint(v1,0,0,2),TimePoint(v2,1,1,2),
//            TimePoint(v3,0,0,2),TimePoint(v4,1,1,2))<<endl;
//    cout<<Trajectory::line2MBRDistance(TimePoint(v1,0,0,2),TimePoint(v2,1,1,2),
//            Region(pLow,pHigh,3))<<endl;

//    Trajectory traja;
//    traja.loadFromString("17778.000000,17543.000000,485.000000 17787.789971,17567.086437,486.000000 17797.579943,17591.172875,487.000000 17807.369914,17615.259312,488.000000 17817.159885,17639.345749,489.000000 17826.949856,17663.432187,490.000000 17836.739828,17687.518624,491.000000 17840.106177,17712.658699,492.000000 17838.523750,17738.610499,493.000000 17836.941323,17764.562299,494.000000 17835.125230,17790.497241,495.000000 17832.966047,17816.407431,496.000000 17830.806865,17842.317620,497.000000 17824.247663,17867.234211,498.000000 17815.063174,17891.557968,499.000000 17805.878685,17915.881726,500.000000 17796.694195,17940.205483,501.000000 17787.509706,17964.529240,502.000000 17778.325217,17988.852997,503.000000 17769.140728,18013.176754,504.000000 17759.956239,18037.500511,505.000000 17750.771749,18061.824268,506.000000 17741.587260,18086.148025,507.000000 17737.028723,18111.571502,508.000000 17734.284364,18137.426259,509.000000 17731.540004,18163.281017,510.000000 17728.795644,18189.135774,511.000000 17726.051284,18214.990532,512.000000 17723.306925,18240.845289,513.000000 17720.562565,18266.700047,514.000000 17723.487434,18292.373955,515.000000 17727.874085,18318.001231,516.000000 17732.260735,18343.628507,517.000000 17736.647386,18369.255784,518.000000 17743.094715,18394.339212,519.000000 17751.925472,18418.793613,520.000000 17760.756228,18443.248015,521.000000 17769.586984,18467.702416,522.000000 17771.982950,18492.994123,523.000000 17644.786266,18535.148644,524.000000 17517.589582,18577.303165,525.000000 17389.031479,18614.287901,526.000000 17257.570322,18640.248718,527.000000 17125.008294,18647.900622,528.000000 16992.558917,18630.695301,529.000000 16862.708040,18597.608299,530.000000 16734.756447,18558.039141,531.000000 16607.582107,18515.817260,532.000000 16562.000000,18505.000000,533.000000");
//    double plow[3]={16083.3,16481.8,485};
//    double pHigh[3]={17853,17749.1,485};
//    Region* query=new Region(plow,pHigh,3);
//    Region bra;
//    MBC bca;
//    traja.getMBRfull(bra);
//    traja.getMBC(bca);
//    cout<<*query<<endl<<bra<<endl<<bca<<endl;
//    query->intersectsShape(bra);
//    query->intersectsShape(bca);
//    double rlow[3]={11790.8,20103.8,79};
//    double rhigh[3]={12863.3,21411.3,99};
//    double clow[2]={16521.4,21944.1};
//    double chigh[2]={12213.8,18130.7};
//    Region br(rlow,rhigh,3);
//    MBC bc(clow,chigh,54,106,2,1330.78,119.552);
//    std::cerr<<bc.intersectsRegion(br);
    Trajectory traja;
    traja.loadFromString("14889.000000,8308.000000,4766.000000 14794.327234,8315.657777,4768.000000 14467.921698,8423.474924,4775.000000 14219.892398,8594.878386,4781.000000 14062.491019,8764.441381,4786.000000 14052.562340,9015.495128,4791.000000 14013.840986,9364.994681,4798.000000 13937.562626,9912.357990,4809.000000 13929.818751,9962.007712,4810.000000 13898.892189,10160.614227,4814.000000 13891.160548,10210.265855,4815.000000 13867.186019,10409.466838,4819.000000 13866.375640,10459.710303,4820.000000 13860.702991,10811.414559,4827.000000 13859.082234,10911.901489,4829.000000 13858.271856,10962.144954,4830.000000 13858.000000,11062.642762,4832.000000 13858.282941,11163.141589,4834.000000 13859.532208,11313.886413,4837.000000 13769.272817,11696.319205,4845.000000 13560.646647,12097.445222,4854.000000 13517.892419,12188.262975,4856.000000 13498.866119,12234.771709,4857.000000 13386.092744,12514.379958,4863.000000 13349.257030,12607.886002,4865.000000 13257.167744,12841.651110,4870.000000 13220.332030,12935.157154,4872.000000 13200.187598,12981.191925,4873.000000 13139.659209,13119.256680,4876.000000 12934.347800,13521.968164,4885.000000 12812.878273,13741.883070,4890.000000 12789.413702,13786.214410,4891.000000 12738.560680,13928.124945,4894.000000 12722.460385,13975.725817,4895.000000 12710.765056,14024.557247,4896.000000 12656.579182,14269.894562,4901.000000 12634.971600,14368.044256,4903.000000 12579.857129,14613.168891,4908.000000 12523.872891,14752.883340,4911.000000 12463.863333,14891.152178,4914.000000 12442.964821,14936.850259,4915.000000 12340.037249,15166.047199,4920.000000 12277.959751,15303.422403,4923.000000 12199.782254,15488.544364,4927.000000 11919.933974,16076.255673,4940.000000 11717.552008,16576.839083,4951.000000 11703.222368,16625.002596,4952.000000 11735.435034,16710.119228,4954.000000 11768.546303,16747.868694,4955.000000 11865.432239,16758.428650,4957.000000 11892.000000,16759.000000,4958.000000");
    auto b=traja.getSegments(10);
    b;
    return 0;
}
